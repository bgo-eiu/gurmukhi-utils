const vishraams = Object.values( require( './vishraams' ) )

// Mappings
const shahmukhiMappings = {
  'ਖ਼ੁ': 'ِخو',
  ਖ਼ੁ: 'ِخو',
  '(?<=[\s,.:;"\']|^)ਉਹ': 'اوہ',
  '(?<=[\s,.:;"\']|^)ਆਏਗਾ(?=[\s,.:;"\']|$)': 'آۓگا',
  'ਆਏਗਾ(?=[\s,.:;"\']|$)': 'اۓگا',
  'ਾਏਗਾ(?=[\s,.:;"\']|$)': 'اۓگا',
  'ਏਗਾ(?=[\s,.:;"\']|$)': 'اےگا',
  '(?<=[\s,.:;"\']|^)ਛਾਂਗਾ(?=[\s,.:;"\']|$)': 'چھانگا',
  '(?<=[\s,.:;"\']|^)ਛਾਂਗੀ(?=[\s,.:;"\']|$)': 'چھانگی',
  '(?<=[\s,.:;"\']|^)ਢਾਂਗਾ(?=[\s,.:;"\']|$)': 'ڈھانگا',
  '(?<=[\s,.:;"\']|^)ਤਾਂਗਾ(?=[\s,.:;"\']|$)': 'تانگا',
  '(?<=[\s,.:;"\']|^)ਨਾਂਗਾ(?=[\s,.:;"\']|$)': 'نانگا',
  '(?<=[\s,.:;"\']|^)ਭਾਂਗਾ(?=[\s,.:;"\']|$)': 'بھانگا',
  '(?<=[\s,.:;"\']|^)ਲਾਂਗਾ(?=[\s,.:;"\']|$)': 'لانگا',
  '(?<=[\s,.:;"\']|^)ਬਾਂਗੇ(?=[\s,.:;"\']|$)': 'بانگے',
  '(?<=[\s,.:;"\']|^)ਬਝਲਾਂਗੇ(?=[\s,.:;"\']|$)': 'جھلانگے',
  '(?<=[\s,.:;"\']|^)ਇਕਾਂਗੀ(?=[\s,.:;"\']|$)': 'اِکانگی',
  '(?<=[\s,.:;"\']|^)ਸਾਂਗੀ(?=[\s,.:;"\']|$)': 'سانگی',
  '(?<=[\s,.:;"\']|^)ਝਾਂਗੀ(?=[\s,.:;"\']|$)': 'جھانگی',
  '(?<=[\s,.:;"\']|^)ਡਾਂਗੀ(?=[\s,.:;"\']|$)': 'ڈانگی',
  'ਾਂਗਾ(?=[\s,.:;"\']|$)': 'گا\u200cاں',
  '(?<=[\s,.:;"\']|^)ਆਏਗੀ(?=[\s,.:;"\']|$)': 'گاآۓ',
  'ਆਏਗੀ(?=[\s,.:;"\']|$)': 'اۓگی',
  'ਾਏਗੀ(?=[\s,.:;"\']|$)': 'اۓگی',
  'ਏਗੀ(?=[\s,.:;"\']|$)': 'اےگی',
  'ਾਂਗੀ(?=[\s,.:;"\']|$)': 'گی\u200cاں',
  '(?<=[\s,.:;"\']|^)ਆਏਗੇ(?=[\s,.:;"\']|$)': 'آۓگاے',
  'ਆਏਗੇ(?=[\s,.:;"\']|$)': 'اۓگاے',
  'ਾਏਗੇ(?=[\s,.:;"\']|$)': 'اۓگاے',
  'ਏਗੇ(?=[\s,.:;"\']|$)': 'اےگاے',
  'ਾਂਗੇ(?=[\s,.:;"\']|$)': 'گاے\u200cاں',
  '(?<=[\s,.:;"\']|^)ਆਏਗੀਆਂ(?=[\s,.:;"\']|$)': 'آۓگیاں',
  'ਆਏਗੀਆਂ(?=[\s,.:;"\']|$)': 'اۓگیاں',
  'ਾਏਗੀਆਂ(?=[\s,.:;"\']|$)': 'اۓگیاں',
  'ਏਗੀਆਂ(?=[\s,.:;"\']|$)': 'اےگیاں',
  'ਾਂਗੀਆਂ(?=[\s,.:;"\']|$)': 'گیاں\u200cاں',
  'ਊਂਗਾ(?=[\s,.:;"\']|$)': 'گا\u200cوں',
  'ਊਂਗੀ(?=[\s,.:;"\']|$)': 'گی\u200cوں',
  'ਊਂਗੇ(?=[\s,.:;"\']|$)': 'گاے\u200cوں',
  'ਊਂਗੀਆਂ(?=[\s,.:;"\']|$)': 'گیاں\u200cوں',
  '(?<=[\s,.:;"\']|^)ਇਆ': 'ای',
  '(?<=[\s,.:;"\']|^)ਇਉ': 'ایو',
  ਇਆ: 'يا',
  ਇ: 'ِا',
  '(?<=[\s,.:;"\']|^)ਆਈ': 'آئی',
  'ਆਈ': 'ائی',
  'ਾਈ': 'ائی',
  'ਿਓ': 'يو',
  'ਾਏ(?=[\s,.:;"\']|$)': 'اۓ',
  'ਾਏ': 'ائ',
  'ਾਓ': 'اؤ',
  'ਆਓ(?=[\s,.:;"\']|$)': 'اؤ',
  ਆਓ: 'آؤ',
  'ੰਪ': 'مپ',
  'ੰਨ': 'نّ',
  '(?<=[\s,.:;"\']|^)ਉ': 'اُ',
  ਉ: 'و',
  '(?<=[\s,.:;"\']|^)ਊ': 'اُو',
  ਊ: 'ؙو',
  ਈ: 'ای',
  ਏ: 'اے',
  'ਆ(?=[\s,.:;"\']|$)': 'ا',
  ਆ: 'آ',
  'ਐ(?=[\s,.:;"\']|$)': 'اَے',
  ਐ: 'اَی',
  ਔ: 'اَو',
  'ਆਂ(?=[\s,.:;"\']|$)': 'اں',
  ਆਂ: 'آن',
  ੴ: 'اک اونکار',
  '੍ਟ': 'ٹ',
  '੍ਨ': 'ن',
  '੍ਯ(?=[\s,.:;"\']|$)': 'ے',
  '੍ਯ': 'ی',
  '੍ਚ': 'چ',
  '੍ਤ': 'ت',
  'ੰ(?=[\s,.:;"\']|$)': 'ں',
  'ੰ': 'ن',
  '੍ਹ': 'ھ',
  'ਿ': 'ِ',
  'ੀ': 'ی',
  'ੁ': 'ُ',
  'ੂ': 'ُو',
  'ੇ(?=[\s,.:;"\']|$)': 'ے',
  'ੇ': 'ی',
  'ੈ(?=[\s,.:;"\']|$)': 'َے',
  'ੈ': 'َی',
  'ਂ(?=[\s,.:;"\']|$)': 'ں',
  'ਂ': 'ن',
  'ੋ': 'و',
  'ੌ': 'َو',
  '੍ਰ': 'ر',
  'ਾ': 'ا',
  'ੵ(?=[\s,.:;"\']|$)': 'ے',
  'ੵ': 'ی',
  'ੑ': 'ھ',
  'ੱ': 'ّ',
  '੍ਵ': 'و',
  'ਃ': ':',
  ਙ: 'نگ',
  ੳ: 'ا',
  ਅ: 'ا',
  ਬ: 'ب',
  ਭ: 'بھ',
  ਚ: 'چ',
  ਛ: 'چھ',
  ਦ: 'د',
  ਧ: 'دھ',
  ੲ: 'ا',
  ਓ: 'اَو',
  ਡ: 'ڈ',
  ਢ: 'ڈھ',
  'ਗ਼': 'غ',
  ਗ਼: 'غ',
  ਗ: 'گ',
  ਘ: 'گھ',
  ਹ: 'ہ',
  'ਜ਼': 'ز',
  ਜ਼: 'ز',
  ਜ: 'ج',
  ਝ: 'جھ',
  'ਕ਼': 'ق',
  ਕ: 'ک',
  'ਖ਼': 'خ',
  ਖ਼: 'خ',
  ਖ: 'کھ',
  'ਲ਼': 'ࣇ',
  ਲ਼: 'ࣇ',
  ਲ: 'ل',
  ਮ: 'م',
  ਨ: 'ن',
  ਪ: 'پ',
  'ਫ਼': 'ف',
  ਫ਼: 'ف',
  ਫ: 'پھ',
  ਤ: 'ت',
  ਥ: 'تھ',
  ਰ: 'ر',
  'ਸ਼': 'ش',
  ਸ: 'س',
  ਟ: 'ٹ',
  ਠ: 'ٹھ',
  ਵ: 'و',
  ੜ: 'ڑ',
  ਣ: 'ݨ',
  'ਯ(?=[\s,.:;"\']|$)': 'ے',
  ਯ: 'ی',
  ਞ: 'نج',
  '੧': '۱',
  '੨': '۲',
  '੩': '۳',
  '੪': '۴',
  '੫': '۵',
  '੬': '۶',
  '੭': '۷',
  '੮': '۸',
  '੯': '۹',
  '੦': '۰',
  '।': '۔',
  '॥': '۔۔',
  '\\.': '۔',
  ',': '،',
  ';': '؛',
  '-': ' ',
  '਼': '',
}

// Make each mapping an escaped global regex
const mappings = Object
  .entries( shahmukhiMappings )
  .map( ( [ exp, sub ] ) => [ new RegExp( exp.replace(/-/g, '\\x2d'), 'g' ), sub ] )

// Replacement rule to remove trailing ੁ and ਿ for pronunciation
// const replacements = [
//  [ new RegExp( `(\\S[^ਹ])([ਿੁ])([\\s$${vishraams.join( '' )}])`, 'ug' ), '$1$3' ], // Remove trailing ੁ and ਿ except when on ਹ or on a standalone akhar
// ]

const stress = [
  [ new RegExp( `ੱ([\u0A00-\u0A7F])`, 'ug' ), '$1ੱ' ], // Shift position of stress markers to after consonant to allow replacement for Shahmukhi
]

// Precompute the replacements and mappings
// const finalReplacements = [ ...stress, ...replacements, ...mappings ]
const finalReplacements = [ ...stress, ...mappings ]

/**
 * Transliterates Unicode Gurmukhi text to the Shahmukhi script.
 * @param {String} text The Unicode Gurmukhi text to convert.
 * @return {String} A Shahmukhi transliteration of the provided Unicode Gurmukhi string.
 * @example
 * toShahmukhi('ਹਮਾ ਸਾਇਲਿ ਲੁਤਫ਼ਿ ਹਕ ਪਰਵਰਸ਼ ॥') // => هما ساِال لُتف هک پرورش ۔۔
 * toShahmukhi('ਸੁ ਬੈਠਿ ਇਕੰਤ੍ਰ ॥੫੭੮॥') // => سُ بَےٹھ ِاکںتر ۔۔۵۷۸۔۔
 */
// const toShahmukhi = ( text ) => finalReplacements
//   .reduce( ( text, [ pre, exp, sub ] ) => text.replace( pre, exp, sub ), text )
const toShahmukhi = ( text ) => finalReplacements
  .reduce( ( text, [ pre, sub ] ) => text.replace( pre, sub ), text )

module.exports = toShahmukhi
